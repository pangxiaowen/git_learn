## 搜索

在任何规模的代码库中，你经常需要找到函数调用或定义的位置，或者显示方法的历史记录。Git 提供了几个有用的工具，可以让你快速轻松地查找其数据库中存储的代码和提交。我们将介绍其中的一些工具。

## Git Grep

Git 附带一个名为 grep 的命令，它允许你轻松地在任何提交的树、工作目录甚至索引中搜索字符串或正则表达式。在以下示例中，我们将搜索 Git 本身的源代码。

默认情况下，git grep 会查看你的工作目录中的文件。作为第一个变体，你可以使用 -n 或 --line-number 选项来打印出 Git 找到匹配项的行号

git grep -n gmtime_r

你可以让 git grep 不打印所有匹配项，而是通过使用 -c 或 --count 选项，只显示包含搜索字符串的文件以及每个文件中匹配项的数量

git grep --count gmtime_r

如果你对搜索字符串的上下文感兴趣，你可以使用 -p 或 --show-function 选项，为每个匹配的字符串显示包含它的方法或函数

git grep -p gmtime_r *.c

你也可以使用 --and 标志搜索字符串的复杂组合，它确保多个匹配必须出现在同一行文本中。

git grep --break --heading \
    -n -e '#define' --and \( -e LINK -e BUF_MAX \) v1.8.0

git grep 命令比普通搜索命令（如 grep 和 ack）有一些优势。第一个是它速度非常快，第二个是你可以搜索 Git 中的任何树，而不仅仅是工作目录。

## Git 日志搜索

也许你正在寻找的不是术语的位置，而是它存在或引入的时间。git log 命令提供了许多强大的工具，用于通过其消息内容甚至引入的差异内容来查找特定的提交。

例如，如果我们想找出 ZLIB_BUF_MAX 常量最初引入的时间，我们可以使用 -S 选项（俗称 Git“镐”选项）来告诉 Git 只显示那些更改该字符串出现次数的提交。

$ git log -S ZLIB_BUF_MAX --oneline

如果你需要更具体，可以使用 -G 选项提供要搜索的正则表达式。

## 行日志搜索

另一个非常高级且非常有用的日志搜索是行历史搜索。只需运行带有 -L 选项的 git log，它就会显示代码库中函数或代码行的历史记录。

例如，如果我们想查看 zlib.c 文件中 git_deflate_bound 函数所做的所有更改，我们可以运行 git log -L :git_deflate_bound:zlib.c。这将尝试找出该函数的边界，然后查看历史记录并向我们展示从创建该函数开始，对该函数所做的所有更改，这些更改将显示为一系列补丁。

git log -L :git_deflate_bound:zlib.c